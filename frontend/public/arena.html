<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeBattle Arena - Competition Rooms</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'arena-primary': '#8B5CF6',
                        'dark-bg': '#0a0a0f',
                        'dark-card': '#1a1a2e',
                    }
                }
            }
        }
    </script>
    <style>
        body { background: #0a0a0f; color: white; }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navigation -->
    <nav class="border-b border-gray-800 bg-dark-card sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <a href="/" class="text-2xl font-bold bg-gradient-to-r from-purple-500 to-pink-500 bg-clip-text text-transparent">
                    CodeBattle Arena
                </a>
                <div class="flex gap-6">
                    <a href="#challenges" class="text-gray-400 hover:text-white transition-colors">Challenges</a>
                    <a href="#rooms" class="text-gray-400 hover:text-white transition-colors">Rooms</a>
                    <a href="#leaderboard" class="text-gray-400 hover:text-white transition-colors">Leaderboard</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Banner -->
        <div class="mb-8 p-6 bg-gradient-to-r from-purple-900/40 to-pink-900/40 rounded-xl border border-purple-500/30">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold mb-2">‚öîÔ∏è Competition Rooms</h2>
                    <p class="text-gray-300">Create rooms, join battles, and compete with AI-generated challenges!</p>
                </div>
                <button onclick="showCreateRoomModal()" class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg transition-all">
                    + Create Room
                </button>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="text-center py-12">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"></div>
            <p class="mt-4 text-gray-400">Loading rooms...</p>
        </div>

        <!-- Rooms Grid -->
        <div id="rooms-container" class="hidden grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Rooms will be loaded here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-12 bg-dark-card rounded-xl border border-gray-800">
            <h3 class="text-2xl font-semibold mb-2">No Active Rooms</h3>
            <p class="text-gray-400 mb-6">Be the first to create a competition room!</p>
            <button onclick="showCreateRoomModal()" class="px-6 py-3 bg-purple-500 hover:bg-purple-600 text-white font-semibold rounded-lg">
                Create First Room
            </button>
        </div>
    </div>

    <!-- Create Room Modal -->
    <div id="createRoomModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="bg-dark-card rounded-xl border border-gray-800 p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-3xl font-bold mb-6">üèÜ Create Competition Room</h2>
            <form onsubmit="createRoom(event)" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium mb-2">Room Name *</label>
                    <input type="text" id="roomName" required
                        class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-purple-500 text-white"
                        placeholder="e.g., Friday Code Battle">
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">Description</label>
                    <textarea id="roomDesc" rows="3"
                        class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-purple-500 text-white"
                        placeholder="What's this competition about?"></textarea>
                </div>

                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Difficulty</label>
                        <select id="difficulty"
                            class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-purple-500 text-white">
                            <option value="easy">Easy</option>
                            <option value="medium" selected>Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Max Participants</label>
                        <input type="number" id="maxParticipants" value="10" min="2" max="50"
                            class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-purple-500 text-white">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">Time Limit (minutes)</label>
                    <input type="number" id="timeLimit" value="60" min="10" max="240"
                        class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-purple-500 text-white">
                </div>

                <div class="border-t border-gray-800 pt-6">
                    <label class="flex items-center gap-3 cursor-pointer mb-4">
                        <input type="checkbox" id="generateAI" class="w-5 h-5">
                        <div>
                            <span class="font-semibold">ü§ñ Generate AI Questions</span>
                            <p class="text-sm text-gray-400">Automatically create coding challenges using AI</p>
                        </div>
                    </label>

                    <div id="aiOptions" class="hidden">
                        <label class="block text-sm font-medium mb-2">Number of Questions</label>
                        <input type="number" id="questionCount" value="3" min="1" max="10"
                            class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-purple-500 text-white">
                    </div>
                </div>

                <div class="flex gap-4">
                    <button type="button" onclick="hideCreateRoomModal()"
                        class="flex-1 px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-lg">
                        Cancel
                    </button>
                    <button type="submit"
                        class="flex-1 px-6 py-3 bg-purple-500 hover:bg-purple-600 text-white font-semibold rounded-lg">
                        Create Room
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000';

        // Load rooms on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadRooms();
            
            // AI checkbox toggle
            document.getElementById('generateAI').addEventListener('change', (e) => {
                document.getElementById('aiOptions').classList.toggle('hidden', !e.target.checked);
            });
        });

        async function loadRooms() {
            try {
                const response = await fetch(`${API_URL}/api/rooms`);
                const data = await response.json();
                
                document.getElementById('loading').classList.add('hidden');
                
                if (data.rooms && data.rooms.length > 0) {
                    displayRooms(data.rooms);
                    document.getElementById('rooms-container').classList.remove('hidden');
                } else {
                    document.getElementById('empty-state').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Failed to load rooms:', error);
                document.getElementById('loading').innerHTML = '<p class="text-red-400">‚ö†Ô∏è Failed to load rooms. Make sure backend is running!</p>';
            }
        }

        function displayRooms(rooms) {
            const container = document.getElementById('rooms-container');
            container.innerHTML = rooms.map(room => `
                <div class="p-6 bg-dark-card rounded-xl border border-gray-800 hover:border-purple-500 transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                            room.status === 'waiting' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'
                        }">
                            ${room.status.toUpperCase()}
                        </span>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold ${getDifficultyColor(room.difficulty)}">
                            ${room.difficulty.toUpperCase()}
                        </span>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">${room.name}</h3>
                    ${room.description ? `<p class="text-gray-400 text-sm mb-4">${room.description}</p>` : ''}
                    <div class="space-y-2 text-sm mb-4">
                        <div class="flex items-center justify-between text-gray-400">
                            <span>Creator:</span>
                            <span class="text-white">${room.creator_name || 'Unknown'}</span>
                        </div>
                        <div class="flex items-center justify-between text-gray-400">
                            <span>Participants:</span>
                            <span class="text-white">${room.participant_count || 0}/${room.max_participants}</span>
                        </div>
                    </div>
                    <button onclick="joinRoom('${room.id}')" class="w-full px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white font-semibold rounded-lg transition-all">
                        Join Room
                    </button>
                </div>
            `).join('');
        }

        function getDifficultyColor(difficulty) {
            const colors = {
                easy: 'bg-green-500/20 text-green-400',
                medium: 'bg-yellow-500/20 text-yellow-400',
                hard: 'bg-red-500/20 text-red-400'
            };
            return colors[difficulty] || colors.medium;
        }

        async function createRoom(event) {
            event.preventDefault();
            
            const roomData = {
                name: document.getElementById('roomName').value,
                description: document.getElementById('roomDesc').value,
                difficulty: document.getElementById('difficulty').value,
                max_participants: parseInt(document.getElementById('maxParticipants').value),
                time_limit: parseInt(document.getElementById('timeLimit').value) * 60,
                creator_id: 'user-' + Math.random().toString(36).substr(2, 9)
            };

            try {
                const response = await fetch(`${API_URL}/api/rooms`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(roomData)
                });

                if (response.ok) {
                    const data = await response.json();
                    
                    // Generate AI questions if requested
                    if (document.getElementById('generateAI').checked) {
                        const questionCount = parseInt(document.getElementById('questionCount').value);
                        await generateAIQuestions(data.room.id, roomData.difficulty, questionCount);
                    }
                    
                    alert('‚úÖ Room created successfully!');
                    hideCreateRoomModal();
                    loadRooms();
                } else {
                    alert('‚ùå Failed to create room');
                }
            } catch (error) {
                console.error('Error creating room:', error);
                alert('‚ùå Error: ' + error.message);
            }
        }

        async function generateAIQuestions(roomId, difficulty, count) {
            try {
                await fetch(`${API_URL}/api/ai-questions/generate-batch`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ difficulty, count, topics: ['algorithms'] })
                });
            } catch (error) {
                console.error('Failed to generate AI questions:', error);
            }
        }

        function joinRoom(roomId) {
            alert(`üéÆ Joining room ${roomId}...\nFull room interface coming soon!`);
            // You can redirect to a dedicated room page here
        }

        function showCreateRoomModal() {
            document.getElementById('createRoomModal').classList.remove('hidden');
        }

        function hideCreateRoomModal() {
            document.getElementById('createRoomModal').classList.add('hidden');
            document.getElementById('roomName').value = '';
            document.getElementById('roomDesc').value = '';
        }

        // Refresh rooms every 10 seconds
        setInterval(loadRooms, 10000);
    </script>
</body>
</html>

